<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE project [
   <!ENTITY init                                        SYSTEM "include/init.xml">
   <!ENTITY config                                      SYSTEM "include/config.xml">
]>
<project basedir="." default="main" name="Convertor">
<!-- ant -Dwebtest.home=D:\Developpement\ProjetCVS\CanooWebTest\webtest -buildfile=webtest/MainTest.xml  -->

    &init;
    
    <!-- ******************************************* -->
    <!-- *** Main test                          **** -->
    <!-- ******************************************* -->
    <target name="main">
        <!-- Check the default page -->
        <antcall target="DefaultPage"/>
        
        <!-- Init database context -->
        <antcall target="DeleteAllFlow"/>
        <antcall target="CheckNbFlow">
            <param name="nb.flow" value="0"/>
        </antcall>
        
        <!-- Check the weaving of the sample & search screen -->
        <antcall target="InsertOneFlow"/>
        <antcall target="CheckNbFlow">
            <param name="nb.flow" value="1"/>
        </antcall>
        
        <!-- Check the weaving of the sample & search screen -->
        <antcall target="InsertOneFlow"/>
        <antcall target="CheckNbFlow">
            <param name="nb.flow" value="2"/>
        </antcall>

        <!-- Check deletion -->
        <antcall target="DeleteAllFlow"/>
        <antcall target="CheckNbFlow">
            <param name="nb.flow" value="0"/>
        </antcall>

        <!-- Create 3 flows -->
        <antcall target="InsertOneFlow"/>
        <antcall target="InsertOneFlow"/>
        <antcall target="InsertOneFlow"/>

        <!-- Check search criteria -->
        <antcall target="CheckSearchCriterion"/>

        <!-- Check order -->
        <antcall target="CheckOrderableResultTable"/>

        <!-- Check detail page -->
        
        <!-- search measure with data -->
        
        <!-- search measure without data -->
        
        <!-- Check statistique -->
    </target>


    <!-- ******************************************* -->
    <!-- *** tests details                      **** -->
    <!-- ******************************************* -->
    <target name="trash">

    </target>

    <target name="Empty">
        <testSpec name="">
            &config;
            <steps>
            </steps>
        </testSpec>
    </target>
    
    <target name="CheckOrderableResultTable">
        <testSpec name="CheckOrderableResultTable">
            &config;
            <steps>
                <!-- First get the results -->
                <invoke description="CheckOrderableResultTable" url="administration_console/FlowSearch.do"/>
                <verifytitle description="get criterion mask" text="Console d&apos;administration de JavaMonitoring"/>
                <setinputfield name="beginDate"             value="" description="params"/>
                <setinputfield name="firstMeasureGroupName" value="" description="params"/>
                <setinputfield name="threadName"            value="" description="params"/>
                <setinputfield name="durationMin"           value="" description="params"/>
                <setinputfield name="firstMeasureMethodName" value="" description="params"/>
                <setinputfield name="firstMeasureClassName" value="" description="params"/>
                <clickbutton htmlId="but_submit" x="29" y="7" description="Form submitted by POST action" />
                <verifytitle text="Console d'administration de JavaMonitoring" description="get results"/>
                
                <!-- We check the number of rows -->
                <verifyXPath  description="The first line"  text="1" xpath="string(//table[@id='results']/tbody/tr[1]/td[1]/a)" />
                <verifyXPath  description="The third line"  text="3" xpath="string(//table[@id='results']/tbody/tr[3]/td[1]/a)" />
                
                <!-- Asc for ascending order of id -->
                <clicklink label="Tech Id" description="" />
                <verifytitle text="Console d'administration de JavaMonitoring" description=""/>
                <verifyXPath  description="The first line"  text="1" xpath="string(//table[@id='results']/tbody/tr[1]/td[1]/a)" />
                <verifyXPath  description="The third line"  text="3" xpath="string(//table[@id='results']/tbody/tr[3]/td[1]/a)" />

                <!-- Asc for descending order of id -->
                <clicklink label="Tech Id" description="" />
                <verifytitle text="Console d'administration de JavaMonitoring" description=""/>
                <verifyXPath  description="The first line"  text="3" xpath="string(//table[@id='results']/tbody/tr[1]/td[1]/a)" />
                <verifyXPath  description="The third line"  text="1" xpath="string(//table[@id='results']/tbody/tr[3]/td[1]/a)" />

                <!-- Asc for ascending order of duration -->
                <clicklink label="Duration" description="" />
                <verifytitle text="Console d'administration de JavaMonitoring" description=""/>
                <storeXPath  description="The first line"  property="test1.firstValue"  propertyType="dynamic"
                    xpath="string(//table[@id='results']/tbody/tr[1]/td[4])" />
                <storeXPath  description="The third line"  property="test1.thirdValue"  propertyType="dynamic"
                    xpath="string(//table[@id='results']/tbody/tr[3]/td[4])" />

                <!-- Asc for descending order of duration -->
                <clicklink label="Duration" description="" />
                <verifytitle text="Console d'administration de JavaMonitoring" description=""/>
                <verifyXPath  description="The first line"  text="#{test1.thirdValue}"  
                    xpath="string(//table[@id='results']/tbody/tr[1]/td[4])" />
                <verifyXPath  description="The third line"  text="#{test1.firstValue}"  
                    xpath="string(//table[@id='results']/tbody/tr[3]/td[4])" />



            </steps>
        </testSpec>
        <!--echo>${test1.firstValue}</echo-->
    </target>
    
    <!-- Check all criterion -->
    <target name="CheckSearchCriterion">
        <!-- Check Date criterion Old one -->
        <antcall target="CheckNbFlowWithCriterion">
            <param name="nb.flow"       value="0"/>
            <param name="beginDate"     value="08/11/05"/>
            <param name="groupName"     value=""/>
            <param name="threadName"    value=""/>
            <param name="durationMin"   value=""/>
            <param name="methodName"    value=""/>
            <param name="className"     value=""/>
        </antcall>
        
        <tstamp>
            <format property="toDay" pattern="dd/MM/yyyy" />
        </tstamp>
        <!-- Check Date criterion ToDay -->
        <antcall target="CheckNbFlowWithCriterion">
            <param name="nb.flow"       value="3"/>
            <param name="beginDate"     value="${toDay}"/>
            <param name="groupName"     value=""/>
            <param name="threadName"    value=""/>
            <param name="durationMin"   value=""/>
            <param name="methodName"    value=""/>
            <param name="className"     value=""/>
        </antcall>
        
        <!-- Check good group -->
        <antcall target="CheckNbFlowWithCriterion">
            <param name="nb.flow"       value="3"/>
            <param name="beginDate"     value=""/>
            <param name="groupName"     value="AllExec"/>
            <param name="threadName"    value=""/>
            <param name="durationMin"   value=""/>
            <param name="methodName"    value=""/>
            <param name="className"     value=""/>
        </antcall>
        
        <!-- Check bad group -->
        <antcall target="CheckNbFlowWithCriterion">
            <param name="nb.flow"       value="0"/>
            <param name="beginDate"     value=""/>
            <param name="groupName"     value="AllExed"/>
            <param name="threadName"    value=""/>
            <param name="durationMin"   value=""/>
            <param name="methodName"    value=""/>
            <param name="className"     value=""/>
        </antcall>
        
        <!-- Check good thread -->
        <antcall target="CheckNbFlowWithCriterion">
            <param name="nb.flow"       value="3"/>
            <param name="beginDate"     value=""/>
            <param name="groupName"     value=""/>
            <param name="threadName"    value="ExecuteThread: "/>
            <param name="durationMin"   value=""/>
            <param name="methodName"    value=""/>
            <param name="className"     value=""/>
        </antcall>
        
        <!-- Check bad thread -->
        <antcall target="CheckNbFlowWithCriterion">
            <param name="nb.flow"       value="0"/>
            <param name="beginDate"     value=""/>
            <param name="groupName"     value=""/>
            <param name="threadName"    value="ExecuteThread:Z"/>
            <param name="durationMin"   value=""/>
            <param name="methodName"    value=""/>
            <param name="className"     value=""/>
        </antcall>
        
        <!-- Check good duration min -->
        <antcall target="CheckNbFlowWithCriterion">
            <param name="nb.flow"       value="3"/>
            <param name="beginDate"     value=""/>
            <param name="groupName"     value=""/>
            <param name="threadName"    value=""/>
            <param name="durationMin"   value="10"/>
            <param name="methodName"    value=""/>
            <param name="className"     value=""/>
        </antcall>
        
        <!-- Check bad duration min -->
        <antcall target="CheckNbFlowWithCriterion">
            <param name="nb.flow"       value="0"/>
            <param name="beginDate"     value=""/>
            <param name="groupName"     value=""/>
            <param name="threadName"    value="500"/>
            <param name="durationMin"   value=""/>
            <param name="methodName"    value=""/>
            <param name="className"     value=""/>
        </antcall>
        
        <!-- Check good method name -->
        <antcall target="CheckNbFlowWithCriterion">
            <param name="nb.flow"       value="3"/>
            <param name="beginDate"     value=""/>
            <param name="groupName"     value=""/>
            <param name="threadName"    value=""/>
            <param name="durationMin"   value=""/>
            <param name="methodName"    value="ru"/>
            <param name="className"     value=""/>
        </antcall>
        
        <!-- Check bad method name -->
        <antcall target="CheckNbFlowWithCriterion">
            <param name="nb.flow"       value="0"/>
            <param name="beginDate"     value=""/>
            <param name="groupName"     value=""/>
            <param name="threadName"    value=""/>
            <param name="durationMin"   value=""/>
            <param name="methodName"    value="runn"/>
            <param name="className"     value=""/>
        </antcall>
        
        <!-- Check good class name -->
        <antcall target="CheckNbFlowWithCriterion">
            <param name="nb.flow"       value="3"/>
            <param name="beginDate"     value=""/>
            <param name="groupName"     value=""/>
            <param name="threadName"    value=""/>
            <param name="durationMin"   value=""/>
            <param name="methodName"    value=""/>
            <param name="className"     value="org.jmonitoring.sample.main.RunSa"/>
        </antcall>
        
        <!-- Check bad class name -->
        <antcall target="CheckNbFlowWithCriterion">
            <param name="nb.flow"       value="0"/>
            <param name="beginDate"     value=""/>
            <param name="groupName"     value=""/>
            <param name="threadName"    value=""/>
            <param name="durationMin"   value=""/>
            <param name="methodName"    value=""/>
            <param name="className"     value="org.jmonitoring.sample.main.RunSampleS"/>
        </antcall>
        
        <!-- Check all good -->
        <antcall target="CheckNbFlowWithCriterion">
            <param name="nb.flow"       value="3"/>
            <param name="beginDate"     value="${toDay}"/>
            <param name="groupName"     value="AllExec"/>
            <param name="threadName"    value="ExecuteThread: "/>
            <param name="durationMin"   value="10"/>
            <param name="methodName"    value="run"/>
            <param name="className"     value="org.jmonitoring.sample.main.RunSa"/>
        </antcall>
        
        <!-- Check all bad -->
        <antcall target="CheckNbFlowWithCriterion">
            <param name="nb.flow"       value="0"/>
            <param name="beginDate"     value="08/11/2005"/>
            <param name="groupName"     value="AllExed"/>
            <param name="threadName"    value="ExecuteThread: Z"/>
            <param name="durationMin"   value="1000"/>
            <param name="methodName"    value="ran"/>
            <param name="className"     value="org.jmonitoring.sample.main.RunSampleS"/>
        </antcall>
        
    </target>

    <target name="CheckNbFlowWithCriterion">
        <testSpec name="CheckNbFlowWithCriterion">
            &config;
            <steps>
                <invoke description="CheckNbFlowWithCriterion" url="administration_console/FlowSearch.do"/>
                <verifytitle description="get criterion mask" text="Console d&apos;administration de JavaMonitoring"/>
                <setinputfield name="beginDate"             value="${beginDate}" description="params"/>
                <setinputfield name="firstMeasureGroupName" value="${groupName}" description="params"/>
                <setinputfield name="threadName"            value="${threadName}" description="params"/>
                <setinputfield name="durationMin"           value="${durationMin}" description="params"/>
                <setinputfield name="firstMeasureMethodName" value="${methodName}" description="params"/>
                <setinputfield name="firstMeasureClassName" value="${className}" description="params"/>
                <clickbutton htmlId="but_submit" x="29" y="7" description="Form submitted by POST action" />
                <verifytitle text="Console d'administration de JavaMonitoring" description="get results"/>
                
                <!-- Wecheck the number of rows -->
                <verifyXPath  description="Check that we have only ${nb.flow} line" text="${nb.flow}" 
                    xpath="count(//table[@id='results']/tbody/tr)" />
            </steps>
        </testSpec>
    </target>


    <target name="CheckNbFlow">
        <antcall target="CheckNbFlowWithCriterion">
            <param name="nb.flow"       value="${nb.flow}"/>
            <param name="beginDate"     value=""/>
            <param name="groupName"     value=""/>
            <param name="threadName"    value=""/>
            <param name="durationMin"   value=""/>
            <param name="methodName"    value=""/>
            <param name="className"     value=""/>
        </antcall>
     </target>
    
    <target name="InsertOneFlow">
        <testSpec name="Sample Homepage InsertOneFlow">
            &config;
            <steps>
                <invoke description="Default page" url="sample_webapp/"/>
                <verifytitle description="Check title" text="Sample for testing JavaMonitoringTool"/>
                
                <invoke description="Weaved a Flow" url="sample_webapp/AlreadyWeaved.do"/>
                <verifytitle description="Check title of the page" text="Sample for testing JavaMonitoringTool"/>
                <verifyText description="Check text of the page" text="ExecutionFlow creation succed"/>
                <verifyText regex="true" description="Check date of the execution" text="at (Sun|Mon|Tue|Wed|Thu|Fri|Sat)"/>
            </steps>
        </testSpec>
    </target>

    <target name="DeleteAllFlow">
        <testSpec name="Delete All Flow">           
            &config;
            <steps>
                <invoke description="Request Delete Flow Page" url="administration_console/DeleteAllFlowsConfirm.do"/>
                <verifytitle description="Check Title" text="Console d&apos;administration de JavaMonitoring"/>
                <verifyText description="Check confirmation message" text="Delete All Flow Confirmation"/>
                <verifyText description="Check confirmation message" text="Are you sure that you want to delete all flows in the database ?"/>
                
                <clicklink label="Ok" description="Deletion confirmed"/>
                <verifytitle description="Check Title" text="Console d&apos;administration de JavaMonitoring"/>
                <verifyText description="Check that flow has been deleted in page" text="All Flows have been deleted."/>
            </steps>
        </testSpec>
    </target>
    
    <target name="DefaultPage">
        <testSpec name="Init Page">
            &config;
            <steps>
                <invoke description="Check redirection" url="administration_console/"/>
                <verifytitle description="Check redirection title" text="Console d&apos;administration de JavaMonitoring"/>
        
                <invoke description="Check default page" url="administration_console/Index.do"/>
                <verifytitle description="Check default page title" text="Console d&apos;administration de JavaMonitoring"/>
            </steps>
        </testSpec>
    </target>
</project>